# 7.5 การเขียนโปรแกรมควบคุม

ตัวอย่างต่อไปนี้จะแสดงให้เห็นถึงการใช้งานควบคุมโปรแกรมโดยทั่วไป ให้ลองเชื่อมต่อปุ่มหรือสวิตซ์กับเซ็นเซอร์ 1 และมอเตอร์ไปยังพอร์ตเอาต์พุต A จากนั้นลองใช้โปรแกรมต่อไปนี้

{% tabs %}
{% tab title="Logo" %}
```text
to sensor_control
    forever [
        if sensor1 > 500 [ a, on wait 10 off]
    ]
end
```
{% endtab %}

{% tab title="Tinker" %}
![](https://lh3.googleusercontent.com/RX7aD-7XjLrC8fdN2COk1b3qmD_DxJBKVE26B7X_PNge5djXd7xR8R53uSJqdf1Lq2UVKVbL5Oc2_NbLY7utTb8F-ITUL1Hz72ht_O2saeLgxB5dJFleC0XGZvwppfyG2O_uIL1j)
{% endtab %}
{% endtabs %}

## IF {#if}

การเขียนโปรแกรมควบคุมแบบ IF คืือการทำให้โปรแกรมทำงานก็ต่อเมื่อตรงตามเงื่อนไขที่กำหนดเท่านั้น IF จะตามด้วยเงื่อนไขเสมอ ตัวอย่างข้างต้นแสดงให้เห็นว่าบล็อก IF ตามด้วยเงื่อนไข "ถ้าค่าเซ็นเซอร์ 1 มากกว่า 50" แล้วคำสั่งที่จะเรียกใช้จะอยู่ในส่วน "do" ในกรณีนี้โปรแกรมจะสั่งให้มอเตอร์ A ทำงานเป็นเวลาหนึ่งวินาที

## Conditions {#conditions}

การกำหนดเงื่อนไขที่เหมาะสมสำหรับ IF เป็นสิ่งสำคัญ เมื่อใช้เซ็นเซอร์ ขั้นตอนแรกคือการสังเกตว่าค่าของเซ็นเซอร์มีการเปลี่ยนแปลงอย่างไร จากนั้นจะสามารถกำหนดเงื่อนไขได้ ในตัวอย่างนี้ ค่าเซ็นเซอร์เมื่อไม่ได้กดสวิตซ์มักมีค่าเท่ากับ 0 แต่เมื่อกดสวิตซ์ค่าจะกระโดดไปที่ 1023 ดังนั้นจึงได้เงื่อนไขว่า "ถ้าเซ็นเซอร์ 1 มีค่ามากกว่า 500" ความหมายเช่นเดียวกับ "ถ้ากดสวิตซ์" ตัวเลข 500 ถูกเลือกเป็นจุดกึ่งกลางระหว่างค่าสูงสุดและค่าต่ำสุดที่เป็นไปได้ หากเปลี่ยนเกณฑ์นี้เป็นตัวเลขอื่นๆ เช่น 100 หรือ 1000 โปรแกรมก็ยังสามารถทำงานต่อไปได้สำหรับตัวอย่างนี้

{% hint style="info" %}
ค่าเงื่อนไขจะมีความละเอียดเพิ่มมากขึ้นเมื่อใช้กับเซ็นเซอร์อะนาล็อก ซึ่งค่าจะเปลี่ยนตามสัดส่วนของการวัดสำหรับแต่ละอุปกรณ์ พิจารณาเซ็นเซอร์ตรวจจับแสงที่ใช้ควบคุมหลอดไฟเพื่อให้หลอดไฟสว่างเมื่อมีแสงน้อย สมมติว่าเซ็นเซอร์มีค่าเท่ากับ 0 เมื่อไม่มีแสงในตอนกลางคืน และค่าจะเพิ่มขึ้นจนถึง 800 ในตอนกลางวัน เกณฑ์ที่ดีสำหรับโปรแกรมนี้คืออะไร 400? คำตอบขึ้นอยู่กับความมืดที่ควรจะเป็นก่อนที่ไฟจะเปิดขึ้น ค่าต่ำเกินไปจะทำให้หลอดไฟเปิดช้า ค่าสูงเกินไปจะทำให้หลอดไฟเปิดก่อนเวลาอันควร ในทางปฏิบัติโปรแกรมเมอร์จะต้องศึกษาเกณฑ์ที่เหมาะสมจากการสังเกตเซ็นเซอร์ในเวลานั้น เมื่อเจ้าของหลอดไฟรู้สึกว่ามืดพอที่จะเปิดสวิตซ์ได้ ในกรณีนี้เงื่อนไขจะกำหนดโดยค่าความไวแสงของหลอดไฟ
{% endhint %}

เงื่อนไขต่างๆ สามารถที่จะรวมเข้าด้วยกันเพื่อให้มีความซับซ้อนเพิ่มมากขึ้นได้ ตัวอย่างด้านล่างแสดงเงื่อนไขที่ต้องกดปุ่มสองปุ่มเพื่อเปิดมอเตอร์

```text
if sensor1 > 500 and sensor2 > 500 [ a, on wait 10 off]
```

## IF-ELSE {#if-else}

การเขียนโปรแกรมควบคุมแบบ IF-ELSE เป็นส่วนเพิ่มเติมจาก IF นอกเหนือจากการกำหนดสิ่งที่จะทำเมื่อเงื่อนไขเป็นจริง IF-ELSE ยังสามารถกำหนดได้ว่าจะทำอย่างไรเมื่อเงื่อนไขเป็นเท็จ ตัวอย่างต่อไปนี้จะปรับเปลี่ยนจากตัวอย่างก่อนหน้านี้ โดยมอเตอร์จะทำงานเมื่อสวิตซ์ถูกกดไว้ และเมื่อปล่อยมือที่กดสวิตซ์ มอเตอร์จะหยุดทำงาน

{% tabs %}
{% tab title="Logo" %}
```text
ifelse sensor1 > 500 [a, on] [ a, off]
```
{% endtab %}

{% tab title="Tinker" %}
![](https://lh4.googleusercontent.com/ndPgTRI-wVLPlQpLtO_gxfEdrTUAIxfZN33giTVr3foZEGoUmaYb8wVVaVkYj9XK_7yUqZjCp3lb1IDJKGpuHW72nkQ2IJq74S6SUEbqrjgGOXibXuzw2wZDV7Ci_aTFKXHpJkP3)
{% endtab %}
{% endtabs %}

## FOREVER {#forever}

การเขียนโปรแกรมควบคุมโดยใช้ FOREVER เป็นการบอกว่าบล็อกที่อยู่ในบล็อกนี้จะทำงานวนไปเรื่อยๆ\(ลูป\) ซึ่งโปรแกรมส่วนมากมักจะต้องใช้ลูปนี้ ตัวอย่างการควบคุมเซ็นเซอร์โดยใช้และไม่ใช้ FOREVER ดังแสดงด้านล่าง \(ภาพขวาและซ้ายตามลำดับ\) หากไม่ใช้ FOREVER โปรแกรมจะตรวจสอบเงื่อนไขหนึ่งครั้งและออกจากโปรแกรมซึ่งไม่ใช่พฤติกรรมที่ต้องการ นี่คือข้อผิดพลาดที่พบบ่อยของผู้เริ่มต้น

| ![](https://lh4.googleusercontent.com/Q4EEgXDJnV9EkXZOEx4blecRAjVWdzUHasmo4ORgeasnBrJAlKoT1tM6nwaQq1jBbeZicOTt1vjQ4UOAVaaqu2-dVKjZUNQhmHBqvOoFiky3cOwnYrEj1PrvWh9HPdGw1hXV9xdK) | ![](https://lh4.googleusercontent.com/G1fTh-Pcqm_u7QmlbQfUQzH6BX_erENFgirNtwvjt3BjMNsOD6yItjnq39xAqRoch5q4eov8oXMZcohXFapTA94s2_7MI7ipSUWhXVjSuIldxizaz3qOslQHq-xf3ZuRk6L0nukT) |
| --- | --- |
| ไม่ใช้ FOREVER | ใช้ FOREVER |

## WAITUNTIL {#waituntil}

การเขียนโปรแกรมควบคุมโดยใช้ WAITUNTIL คือการทำให้โปรแกรมหยุดรอจนกว่าเงื่อนไขจะเป็นจริง ตัวอย่างโปรแกรมด้านล่างแสดงวิธีใช้ WAITUNTIL เพื่อให้โปรแกรมส่งเสียปิ๊บแค่ครั้งเดียวต่อการกดสวิตซ์ในแต่ละครั้ง

{% tabs %}
{% tab title="Logo" %}
```text
forever [ 
    if sensor1 > 500 [ 
        beep waituntil [sensor1 < 500]
    ]
]
```
{% endtab %}

{% tab title="Tinker" %}
![](https://lh5.googleusercontent.com/9OVLhSr3SZwCb99-3Lni6eKH6U8mZVMdJJhLWiEdsZf6Bl0LqgQ9tOLJC7f86wpJZi1VG0VfCZaWRu0b4KBroGn-ageKqrVaJHUxgID3G-5T_LaeMNOPaAcyepcLxBeu2c1Sgb8f)
{% endtab %}
{% endtabs %}

{% hint style="info" %}
โปรดทราบว่าหากไม่มี WAITUNTIL โปรแกรมจะส่งเสียงปิ๊บซ้ำๆ ในขณะที่ยังกดสวิตซ์
{% endhint %}

